Fix the Friends system using Option A (Duolingo-style one-row friendships) and add 7-second polling. Update both friendsStore.js and Friends.jsx exactly as follows:

1. Update loadFriends()

Query both directions in one row:

const { data } = await supabase
  .from("friends")
  .select("*")
  .or(`user_id.eq.${userId},friend_id.eq.${userId}`)
  .eq("status", "accepted");


For each result:

row.friendUserId = row.user_id === userId ? row.friend_id : row.user_id;

2. Update loadPendingRequests()
select("*")
  .eq("friend_id", userId)
  .eq("status", "pending")


Make sure rows include id so accept/decline can use it.

3. Fix sendFriendRequest()

Always insert one row:

{ user_id: senderId, friend_id: receiverId, status: "pending" }


Remove any maybeSingle() logic.

After insert → call loadRequests() and loadPendingRequests().

4. Fix acceptFriendRequest(requestId)
update({ status: "accepted" }).eq("id", requestId);


After update → call:

await loadFriends();
await loadRequests();
await loadPendingRequests();

5. Fix declineFriendRequest(requestId)
delete().eq("id", requestId)


Then reload pending/sent.

6. Friends.jsx — add 7s polling while page is active

Inside Friends.jsx:

Import:

const {
  loadFriends,
  loadRequests,
  loadPendingRequests,
} = friendsStore;


Add useEffect for initial load:

useEffect(() => {
  loadFriends();
  loadRequests();
  loadPendingRequests();
}, []);


Add polling loop (stops when leaving page):

useEffect(() => {
  let isMounted = true;

  const poll = async () => {
    if (!isMounted) return;
    await loadFriends();
    await loadRequests();
    await loadPendingRequests();
  };

  const id = setInterval(poll, 7000);

  return () => {
    isMounted = false;
    clearInterval(id);
  };
}, []);

7. Dev Mode Toggle

If Dev Mode exists, wrap polling with:

if (!devModeEnabled) { start polling }

8. Ensure RequestCard handlers pass request.id

All accept/decline buttons must use:

onAccept={() => handleAcceptRequest(request.id)}
onDecline={() => handleDeclineRequest(request.id)}

9. Ensure Friends.jsx uses row.friendUserId

When rendering friend list:

const friendId = friend.friendUserId;

10. Silent error handling

Wrap all loads with:

if (error) console.warn(error);


Apply all fixes, ensure no duplicated rows, ensure sender sees accepted friends after polling, and print a summary of changes.

END PROMPT
Implement the full Friend Challenge System using my existing UI theme and existing modal style.
Do NOT redesign UI.
Do NOT create new modal systems.
All popups must match my current visuals (colours, rounded corners, fonts, spacing).

Use the existing Supabase table friend_challenges exactly as it exists.
Do NOT recreate or rename it.
Only add a field if absolutely necessary.

ğŸ”¹ CORE RULES

One active challenge per friend pair (unique index already exists).

Use Supabase Realtime for all updates.

Use my existing modal/popup components only.

All popups centered + theme-matched.

Do NOT modify challenge screens themselves, only the flow.

ğŸ”¹ SECTION 1 â€” Sending a Challenge

From the Challenge Tab:

User chooses a challenge mode (mind_battle, lightning_round, speed_run, sudden_death).

Open the existing â€œSelect Friendâ€ modal.

When a friend is chosen:

Insert a row into friend_challenges:

sender_id, receiver_id, challenge_type,
status='pending', questions=fixed question set.


Close modal and show popup:
â€œ{Game Mode} challenge sent to {Friend}!â€

In Friends Tab, show â€œChallenge Pendingâ€ badge + cancel option (pending only).

ğŸ”¹ SECTION 2 â€” Receiving a Challenge

When receiver opens the app:

Add a red notification badge on Friends tab (pending + results count).

In Friends Tab, the senderâ€™s row shows:
â€œChallenge Received â€“ Accept?â€
Buttons: Accept / Decline.

Accept:

status â†’ accepted

Receiver immediately starts the challenge using questions stored in the row.

Sender sees â€œChallenge Accepted â€“ Tap to Playâ€.

Decline:

status â†’ cancelled

Sender sees popup: â€œChallenge Declinedâ€.

ğŸ”¹ SECTION 3 â€” Playing + Finishing

Both players answer the same fixed question set (from the questions JSON).

When a player finishes:

If sender: update score/time + status='sender_done'

If receiver: update score/time + status='receiver_done'

If only one finished:
Show: â€œWaiting for your friendâ€¦â€

When both finished:

status â†’ finished

ğŸ”¹ SECTION 4 â€” Showing Results

Second finisher sees results immediately (popup or screen, match theme):

Both scores

Winner or â€œDrawâ€

XP + coins rewards

â€œChallenge Again in {Mode}â€ button

First finisher sees results when they return:

Red badge on Friends

â€œResults Ready â€“ Viewâ€ in Friends list

Challenge Again:

When tapped â†’ open Select Friend modal directly with same mode pre-selected.

ğŸ”¹ SECTION 5 â€” Cancelling

Sender can cancel only while pending.
Status â†’ cancelled.
Sender gets popup: â€œChallenge Cancelledâ€.
Receiver sees nothing.

ğŸ”¹ SECTION 6 â€” Realtime Sync

Enable Supabase Realtime on friend_challenges for rows where the current user is sender or receiver.

Update UI immediately when:

pending â†’ accepted

accepted â†’ ready to play

sender/receiver finished â†’ waiting states

finished â†’ results

cancelled â†’ clear pending UI

Both Challenge Tab and Friends Tab must stay in sync automatically.

ğŸ”¹ SECTION 7 â€” Notifications

Show a red badge on the Friends tab icon with total pending + results count.
No popup on app open â€” badge only.

ğŸ”¹ SECTION 8 â€” UI Requirements

Use my existing modal/popup style everywhere.

No grey system alerts.

No new modal framework.

Keep all spacing, colours, text style consistent.

Popups must be centered and look identical to current ones.

ğŸ”¹ SECTION 9 â€” Safety Rules

Donâ€™t allow user to challenge themselves.

Block sending a new challenge if an active one exists between the same pair.

Donâ€™t unlock challenge unless backend status = accepted.

Use fixed question set stored in the table.

Use the existing table structure.

ğŸ”¹ SECTION 10 â€” Full Integration Checklist

Ensure ALL of the following work together:

Challenge tab â†’ choose mode â†’ choose friend â†’ create row

Friends tab pending/received states

Accept/Decline

Realtime sync

Playing challenge

Sender/receiver finished tracking

Result delivery

Challenge Again

Badge notifications

No duplicate challenges

Supabase read/write correct
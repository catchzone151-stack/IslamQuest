You are Senior Dev Mode.

Create a new file:

src/sync/revisionData.js

Add the following content:

-----------------------------------------
export function normalizeLocalRevisionItem(item) {
  console.log("[RevisionData] normalizeLocalRevisionItem called");

  return {
    lesson_id: item.lessonId,
    card_id: item.cardId,
    strength: item.strength ?? 0,
    times_correct: item.timesCorrect ?? 0,
    times_wrong: item.timesWrong ?? 0,
    last_reviewed_at: item.lastReviewedAt ?? null,
    next_review_at: item.nextReviewAt ?? null,
    updated_at: item.updatedAt ?? new Date().toISOString(),
    extra_data: item.extraData ?? null,
  };
}

export function convertToCloudRow(item, userId) {
  console.log("[RevisionData] convertToCloudRow called");

  return {
    user_id: userId,
    lesson_id: item.lesson_id,
    card_id: item.card_id,
    strength: item.strength,
    times_correct: item.times_correct,
    times_wrong: item.times_wrong,
    last_reviewed_at: item.last_reviewed_at,
    next_review_at: item.next_review_at,
    updated_at: item.updated_at,
    extra_data: item.extra_data,
  };
}

export function convertFromCloudRow(row) {
  console.log("[RevisionData] convertFromCloudRow called");

  return {
    lessonId: row.lesson_id,
    cardId: row.card_id,
    strength: row.strength,
    timesCorrect: row.times_correct,
    timesWrong: row.times_wrong,
    lastReviewedAt: row.last_reviewed_at,
    nextReviewAt: row.next_review_at,
    updatedAt: row.updated_at,
    extraData: row.extra_data,
  };
}

export function validateRevisionItem(item) {
  console.log("[RevisionData] validateRevisionItem called");

  if (!item.lesson_id || !item.card_id) return false;
  if (typeof item.strength !== "number") return false;
  return true;
}
-----------------------------------------

In src/sync/revisionSync.js, add at the top:

import {
  normalizeLocalRevisionItem,
  convertToCloudRow,
  convertFromCloudRow,
  validateRevisionItem
} from "./revisionData.js";

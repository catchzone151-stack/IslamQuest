# Islam Quest - Educational Mobile Web App

## Overview
Islam Quest is a mobile-first web application designed as a gamified Islamic learning platform. Its core purpose is to provide an interactive educational experience, guiding users through structured learning paths that cover fundamental Islamic beliefs, stories of prophets, and other essential knowledge. Key capabilities include a friendly mascot (Zayd), an achievement system, customizable avatars, and quiz-based assessments to reinforce learning. The project aims to make Islamic education engaging and accessible, fostering continuous learning and spiritual growth.

## User Preferences
Preferred communication style: Simple, everyday language.

## System Architecture

### Frontend Architecture
- **Technology Stack**: React 18.2, Vite, JavaScript, React Router DOM v7.9, Framer Motion, Lucide React.
- **Design Pattern**: Component-based architecture with a mobile-first responsive design and a bottom navigation pattern.
- **State Management**: Local state using React hooks, global state with Zustand (`progressStore`, `userStore`, `friendsStore`), and LocalStorage for persistence. Future migration to Supabase for cloud synchronization is planned.
- **Performance Optimizations (November 2025)**: Route-based code splitting using React.lazy() and Suspense for all 12 main app routes (Home, Pathway, Lesson, QuizScreen, Challenge, ChallengeGame, DailyQuest, GlobalEvents, EventQuiz, Friends, Profile, Revise), reducing initial bundle size. React.memo applied to frequently re-rendering components (ProfileCard, LevelBadge, LevelBadgeCompact, DiamondIcon, ProgressBar, QuestionCard) to prevent unnecessary renders. All CSS animations GPU-optimized using only transform and opacity properties for smooth 60fps performance on mobile devices. Custom LoadingScreen component provides smooth transitions during lazy route loading.

### Styling Architecture
- **Approach**: CSS-in-JS using standard CSS files with custom properties for theming.
- **Theme System**: CSS variables define a consistent color palette: Navy (#0B1E2D) for backgrounds, Gold (#D4AF37) for accents, Emerald Green (#10B981) for success, and Light gray (#f3f4f6) for text.
- **Animation**: Built-in CSS keyframes (e.g., fadeIn) for page transitions.

### Data Architecture
- **Content Structure**: 14 complete learning paths (Paths 1-14), each with lessons and quizzes. Content includes "Names of Allah," "Foundations of Islam," "Stories of Prophets," "Life of Muhammad ﷺ," "Angels," "Understanding Hellfire," and "The Beauty of Paradise." All paths are "available" by default and leverage exclusively Qur'an and Sahih Hadith (Bukhari, Muslim, Abu Dawud, Tirmidhi) as primary sources. **Path 9 Update (November 2025)**: Renamed from "Angels and Jinns" to "Angels" with focus exclusively on angels from Qur'an and Sahih Hadith. All Jinn references removed from lesson content while preserving 11 comprehensive angel lessons. **Development Mode (November 2025)**: All paths default to 0% progress and 0 completed lessons for clean testing state.
- **Content Standards**: All lessons follow strict formatting: 3 paragraphs (18-28 words each, targeting ~23), Arabic evidence with English translation, source citations, and "Key Lesson Learned" sections. Age 10+ appropriate language throughout. Quizzes have 4 MCQs per lesson with balanced answer indices.
- **Recent Completion (November 2025)**: Paths 13 (Understanding Hellfire - 19 lessons, 76 quiz questions) and 14 (The Beauty of Paradise - 20 lessons, 80 quiz questions) completed with full content, evidence, and assessments.
- **Progression Model**: XP and coin rewards for lesson completion, streak system for daily engagement, and certificates for path completion. **Universal Lesson Locking System (November 2025)**: Sequential lesson progression enforced across all 14 paths—Lesson 1 always unlocked, subsequent lessons require completion of previous lesson's quiz. Unlocking managed via `lockedLessons[pathId][lessonId]` structure in progressStore. Lock UI features grey gradient overlay, golden lock icon, and reduced opacity (30%) for lesson numbers on locked lessons. Unlocked lessons display dual gold pulse animations: subtle `goldPulse` (10px↔20px glow) for completed/available lessons, stronger `currentLessonPulse` (20px↔30px+40px glow) for the active next lesson. Current lesson also displays bouncing Zayd avatar above card. Full XP/coin/streak integration ensures all activity types (lessons, quizzes, daily quest, friend challenges, global events) correctly trigger rewards and daily completion tracking via unified `markDayComplete()` function. **Premium Lesson Locking (November 2025)**: Tiered freemium model with path-specific free lesson limits (Names of Allah: 5, Foundations: 3, Prophets: 5, Seerah: 7, Wives: 2, Ten Promised: 2, Four Women: 2, Companions: 4, Angels: 3, End Times: 4, Grave: 3, Day of Judgment: 4, Paradise: 3, Hellfire: 3). Premium users ("individual" or "family" plans) bypass paywall but still follow sequential progression. Free users see premium lock on lessons beyond their limit, triggering PurchaseModal with Individual/Family plan options. **Premium Payment System (November 2025)**: Complete payment tier system with Individual Plan (£4.99) and Family Plan (£18, 6 users). Upgraded PurchaseModal features Zayd mascot, benefit bullets (unlock all, lifetime access, no ads, cross-device), and working "Restore Purchase" functionality. Placeholder payment functions (purchaseIndividual, purchaseFamily, restorePurchases) ready for Stripe/RevenueCat integration. Family plan supports up to 5 additional members with invite/remove management (UI-only placeholders). Profile page displays Premium section showing current plan and family members list. All state managed via `premiumStatus`, `familyPlanId`, `familyMembers` in progressStore with localStorage persistence. Supabase-ready architecture for future backend sync.
- **Diamond Level System (November 2025)**: Complete 10-level progression system replacing old titles. Levels 1-10 with unique diamond colors (Bronze→Legendary Gold Gradient), auto-calculated XP thresholds designed for quick early progression (Level 2 at 280 XP ≈2 quizzes), level-up detection triggers Zayd mascot popup animation. Global modal integration in App.jsx. Components: `DiamondIcon`, `LevelBadge`, `ViewAllLevelsModal`, `ZaydLevelUpPopup`. Integrated across Profile, Friends leaderboard, and activity feed. Prepared for Supabase migration with clean store architecture.
- **Asset Management**: Centralized `assets.js` system for optimized WebP images (mascots, avatars, badges).
- **Friends System (Phase 4 - November 2025)**: Complete social features including friend management (add/search by nickname), friend requests (incoming/outgoing with accept/decline), friends leaderboard with Friend of the Week, activity feed with Zayd mascot appearances, and quick messaging with 10 pre-set kid-safe motivational messages. All data stored in LocalStorage with Supabase-ready architecture for Phase 5. Friends display diamond level badges throughout.
- **Friend Challenge System (November 2025)**: Complete friend-vs-friend challenge system with 4 game modes (Mind Duel: 8 MCQs with 12s each, Lightning Round: 10 questions in 60s total, Fill-the-Gap: 9 cloze questions, Lightning Chain: increasing difficulty chain mode), 48-hour active window, questions pulled only from BOTH players' completed lessons, Zayd explainer/countdown/results modals, XP/coin rewards based on win/lose/draw outcomes. Boss Level daily challenge for Level 8-10 users (5 ultra-hard questions, 30s total, +300 XP/+50 coins). All logic structured in Supabase-ready architecture with helper functions (createChallenge, saveChallengeProgress, completeChallenge, getSharedLessons, getQuestionsForMode) using LocalStorage for now. Components: Challenge.jsx (hub page), ChallengeGame.jsx (unified game screen), ChallengeExplainerModal, ChallengeCountdown, ChallengeResultsModal, NoSharedLessonsModal, BossLockedModal.
- **Global Events System (November 2025)**: Weekly competitive events featuring 4 themed challenges (Pillar Clash, Names of Allah Mastery, Faith Test, Seerah Challenge) with 10 hard MCQs each. GMT-based scheduling (Friday-Thursday weeks, results unlock Thursday 22:00). 25 coin entry fee per event, provisional results shown immediately, final results with Top 10 leaderboards and rank-based rewards (1st: +1000 XP/+300 coins). Complete modal system with Zayd mascot integration, countdown animations, and XP/coin rewards integrated with progressStore. Auto-advance quiz flow (500ms delay after answer selection, no Next button). Comprehensive defensive checks prevent duplicate charges, closure issues resolved with selectedAnswerRef, final answer async race condition fixed by passing complete answers array to handleQuizComplete. InsufficientCoinsModal with Zayd mascot for friendly error handling. All data stored in eventsStore with LocalStorage persistence, Supabase-ready architecture. Dev coin grant (5000 coins) gated behind import.meta.env.DEV and hydration check. **Dev Mode Features (November 2025)**: Unlimited quiz retries enabled in development mode via `import.meta.env.DEV` guards at blocking points (GlobalEvents click handler, EventQuiz countdown handler) while preserving true entry state for UI features. Entry blocking moved to GlobalEvents level before navigation for immediate user feedback. **Badge System**: Dual badge system with red "NEW!" badge for un-entered events (disappears on entry) and blue "RESULTS!" badge for unlocked results (disappears after viewing). **Critical Bug Fixes**: FinalResultsModal infinite loop completely resolved by using separate selectors and single initialization effect with ref guard instead of shallow-compared combined selector. Components: `GlobalEvents`, `EventQuiz`, `EventInfoModal`, `CountdownModal`, `ProvisionalResultsModal`, `FinalResultsModal`, `InsufficientCoinsModal`. Question banks in `eventQuestions.js` with 40 total questions sourced from Qur'an and Sahih Hadith.
- **Daily Quest System (November 2025)**: Solo daily challenge featuring 8 MCQs pulled from user's completed lessons, resets midnight GMT, awards +60 XP and +20 coins upon completion. Single-quest-per-day enforcement via localStorage persistence with proper hydration flow (loadDailyQuest on Home mount). State management in dailyQuestStore with helper functions (generateDailyQuestions, checkAndGenerateDailyQuest, completeDailyQuest, getQuestStatus, isQuestAvailable) using Supabase-ready architecture. Questions generated via quizEngine with shuffled options. Components: `DailyQuestCard` (Home page card with Available/In Progress/Completed states), `DailyQuestExplainerModal` (Zayd mascot feature explainer), `DailyQuestCountdown` (3-2-1 countdown), `DailyQuestGame` (quiz screen with guards against direct navigation and pre-hydration entry). Route: `/daily-quest`. All data persisted in localStorage with date tracking for GMT-based daily reset. Card displays on Home page with gradient background and Zayd Challenge mascot animation.
- **Streak Freeze System (November 2025)**: Duolingo-style streak protection with shield mechanics. Purchase shields (100 coins each, max 3), auto-consume on missed days (proportional to gap: 3-day gap = 2 shields), and repair broken streaks (200 coins, restores streak + gifts 1 shield). Components: `PurchaseStreakFreezeModal` and `RepairStreakModal` with Zayd mascot integration. Daily completion tracking unified via `markDayComplete()` called from all activity types. Shields displayed on Home and Profile pages. Complete state machine handles multi-day gaps, skip/repair flows, and same-day restarts. Supabase-ready architecture with LocalStorage persistence.

### Authentication & User Management
- **Provider**: Supabase Auth, integrated via `@supabase/auth-helpers-react` and `@supabase/supabase-js`.
- **Current Status**: Supabase client is configured, but full authentication flows are not yet implemented in components. LocalStorage serves as a temporary persistence layer.

### Build & Deployment
- **Development**: Vite dev server on port 5000 with host binding `0.0.0.0` for Replit compatibility.
- **Production**: `vite build` for optimized bundles and `vite preview` for testing.

## External Dependencies

### Third-Party Services
- **Supabase**: Used for authentication, database, and real-time subscriptions, configured with environment variables (`VITE_SUPABASE_URL`, `VITE_SUPABASE_ANON_KEY`).

### Core Libraries
- **UI & Animation**: `framer-motion`, `lucide-react`, `react-router-dom`.
- **Development Tools**: `vite`, `@vitejs/plugin-react`, `typescript`.

### Asset Dependencies
- **Media Formats**: WebP images for all visual assets (mascots, avatars, badges, certificates) and SVG favicon. All assets are bundled locally.